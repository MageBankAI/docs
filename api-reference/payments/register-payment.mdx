---
title: 'Register Payment'
api: 'POST /payments/register'
description: "Create a new payment transaction between agents"
---

Creates a new payment transaction between agents. The operation registers a payment in the system, evaluates whether approval is required based on sender agent's rules, and initiates the transaction process if no approval is needed.

## Request Headers

<ParamField header="x-api-key" type="string" required>
  Your API key for authentication
</ParamField>

<ParamField header="Content-Type" type="string" required>
  Must be set to `application/json`
</ParamField>

## Request Body

<ParamField body="senderagentid" type="string" required>
  ID of the agent sending the payment (UUID format)
</ParamField>

<ParamField body="receiveragentid" type="string" required>
  ID of the agent receiving the payment (UUID format)
</ParamField>

<ParamField body="paymentdetails" type="object" required>
  <Expandable title="properties">
    <ParamField body="amount" type="number" required>
      Payment amount
    </ParamField>
    <ParamField body="currency" type="string" required>
      Payment currency (typically "USDC")
    </ParamField>
    <ParamField body="method" type="string" required>
      Payment method (typically "CRYPTO_ADDRESS")
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="name" type="string" required>
  Name or description of the payment
</ParamField>

<ParamField body="type" type="string" required>
  Type of payment (EXTERNAL or INTERNAL)
</ParamField>

<ParamField body="contactdetails" type="object">
  <Expandable title="properties">
    <ParamField body="email" type="string">
      Contact email for the payment recipient
    </ParamField>
    <ParamField body="phoneNumber" type="string">
      Contact phone number for the payment recipient
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="tags" type="array">
  Tags or categories for the payment (text[])
</ParamField>

## Response

<ResponseField name="id" type="string">
  Unique payment identifier in short ID format (derived from UUID)
</ResponseField>

<ResponseField name="name" type="string">
  Name or description of the payment
</ResponseField>

<ResponseField name="type" type="string">
  Type of payment (EXTERNAL or INTERNAL)
</ResponseField>

<ResponseField name="status" type="string">
  Current status of the payment (New, Pending, or Confirmed)
</ResponseField>

<ResponseField name="createdat" type="string">
  Timestamp when the payment was created (without timezone)
</ResponseField>

<ResponseField name="approvalRequired" type="boolean">
  Whether this payment requires approval
</ResponseField>

<ResponseField name="approvalstatus" type="string">
  Current approval status (Waiting, Pending, Approved, or Decline)
</ResponseField>

<ResponseField name="txHash" type="string">
  Transaction hash on the blockchain (if processed immediately)
</ResponseField>

## Example Request

<CodeGroup>

```bash cURL
curl -X POST "https://api.magebank.ai/payments/register" \
  -H "x-api-key: YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "senderagentid": "agent_eC6ZezevNsqxvoKmQrUuoU",
    "receiveragentid": "agent_k77NTwxp2Ym3JCmVsKtXQA",
    "paymentdetails": {
      "amount": 6,
      "currency": "USDC",
      "method": "CRYPTO_ADDRESS"
    },
    "name": "Vendor XYZ Payment",
    "type": "EXTERNAL",
    "contactdetails": {
      "email": "contact@vendorxyz.com",
      "phoneNumber": "+1234567890"
    },
    "tags": ["vendor", "regular"]
  }'
```

```javascript Node.js
const axios = require('axios');

async function registerPayment() {
  try {
    const response = await axios.post('https://api.magebank.ai/payments/register', {
      senderagentid: "agent_eC6ZezevNsqxvoKmQrUuoU",
      receiveragentid: "agent_k77NTwxp2Ym3JCmVsKtXQA",
      paymentdetails: {
        amount: 6,
        currency: "USDC",
        method: "CRYPTO_ADDRESS"
      },
      name: "Vendor XYZ Payment",
      type: "EXTERNAL",
      contactdetails: {
        email: "contact@vendorxyz.com",
        phoneNumber: "+1234567890"
      },
      tags: ["vendor", "regular"]
    }, {
      headers: {
        'x-api-key': 'YOUR_API_KEY',
        'Content-Type': 'application/json'
      }
    });
    
    console.log('Payment registered:', response.data);
    return response.data;
  } catch (error) {
    console.error('Error registering payment:', error.response ? error.response.data : error.message);
    throw error;
  }
}

registerPayment();
```

```python Python
import requests
import json

def register_payment():
    url = "https://api.magebank.ai/payments/register"
    headers = {
        "x-api-key": "YOUR_API_KEY",
        "Content-Type": "application/json"
    }
    
    payload = {
        "senderagentid": "agent_eC6ZezevNsqxvoKmQrUuoU",
        "receiveragentid": "agent_k77NTwxp2Ym3JCmVsKtXQA",
        "paymentdetails": {
            "amount": 6,
            "currency": "USDC",
            "method": "CRYPTO_ADDRESS"
        },
        "name": "Vendor XYZ Payment",
        "type": "EXTERNAL",
        "contactdetails": {
            "email": "contact@vendorxyz.com",
            "phoneNumber": "+1234567890"
        },
        "tags": ["vendor", "regular"]
    }
    
    response = requests.post(url, headers=headers, data=json.dumps(payload))
    
    if response.status_code == 200:
        payment_data = response.json()
        print("Payment registered:", payment_data)
        return payment_data
    else:
        print(f"Error: {response.status_code}")
        print(response.text)
        raise Exception(f"API request failed with status {response.status_code}")

register_payment()
```

</CodeGroup>

## Example Response

```json
{
  "id": "payee_wDG5cavUCoK53uvFzTvkey",
  "name": "Vendor XYZ Payment",
  "type": "EXTERNAL",
  "status": "New",
  "approvalstatus": "Waiting",
  "approvalRequired": true,
  "createdat": "2025-04-17T10:28:18.512792",
  "txHash": null
}
```

## Error Responses

<ResponseExample>
```json 400 Missing Required Fields
{
  "error": "Required fields missing: senderagentid, receiveragentid, paymentdetails, name, type"
}
```

```json 400 Invalid Payment Details
{
  "error": "Invalid payment details. Amount must be positive."
}
```

```json 404 Agent Not Found
{
  "error": "Sender agent not found"
}
```

```json 400 Insufficient Balance
{
  "error": "Insufficient balance in sender agent's wallet"
}
```

```json 401 Unauthorized
{
  "error": "Invalid or missing API key"
}
```

```json 500 Internal Server Error
{
  "error": "Internal Server Error"
}
```
</ResponseExample>

## Status Codes

| Status Code | Description |
|-------------|-------------|
| 200 | Payment registered successfully |
| 400 | Bad Request - Invalid or missing parameters |
| 401 | Unauthorized - Invalid or missing API key |
| 404 | Not Found - Agent not found |
| 500 | Internal Server Error |

## Notes

- If the payment amount exceeds the sender agent's transaction limit or daily limit, the request will fail.
- If the payment amount exceeds the `requireApprovalAboveAmount` threshold or if `requireApprovalForAll` is set to true for the sender agent, the payment will require approval before processing.
- For payments that require approval, the `approvalRequired` field in the response will be set to `true`, and you'll need to use the [Approve Payment](/api-reference/payments/approve-payment) endpoint to process it.
- For payments that don't require approval, the system will immediately attempt to process the transaction.
- Both sender and receiver agent IDs can be in either short format or UUID format.
- The `type` field should be "EXTERNAL" (to recipients outside the user's agent network) or "INTERNAL" (between the user's own agents).
- The `status` field can only have values of "New", "Pending", or "Confirmed".
- The `approvalstatus` field can only have values of "Waiting", "Pending", "Approved", or "Decline".
- Payment details and contact details are stored in JSONB format in the database.
- The `tags` field is stored as a text array in the database.